# Конкурентность/Параллелизм

- - - 
#### **Конкурентность** - как управиться со многими вещами одновременно.
#### **Параллелизм** - как делать много вещей одновременно (частный случай конкурентности).
** Rob Pike
- - -

### Основные термины:
- **Конкурентность(многозадачность)** - способность выполнять несколько задач в перекрывающиеся периоды времени, 
создавая иллюзию одновременности.


- **Параллелизм** - выполнение нескольких вычислений одновременно за счет многоядерного процессора.


- **Единица выполнения** - общий термин для объектов, выполняющих код конкурентно, имеющие независимые от других 
состояния и стек вызовов (процессы, потоки и сопрограммы).


- **Процесс** - экземпляр компьютерной программы, который:
- - Имеет свои ресурсы и квант процессорного времени.
- - Взаимодействие посредством каналов или сокетов.
- - Может передавать только "голые байты" (требуется сериализация, например при передаче данных из одного процесса в 
другой).
- - Может порождать подпроцессы.
- - Изолирован (имеет разные пространства памяти).
- - **Вытесняющая многозадачность** - ОС вытесняет периодически рабочий процесс, предоставляя возможность работать 
другим. Переключение осуществляет OS.
- - Свой **GIL**.
- - Используется для CPU-bound операций (вычисления).


- **Поток** - минимальная единица выполнения в рамках процесса (при создании процесса создается главный поток):
- - Потоки работают конкурентно.
- - Имеют общее пространство памяти.
- - Один **GIL** на процесс (для всех потоков).
- - **Вытесняющая многозадачность** - ОС вытесняет периодически рабочий поток, предоставляя возможность работать 
другим. Переключение осуществляет OS.
- - Более легковесны, чем потоки.
- - Используется для I/O-bound операций (сеть, файлы).
- **Переключение между потоками**:
- - GIL освобождается при блокирующих I/O-операциях (например, requests.get(), time.sleep(), чтение файла).
- - Почему - Блокирующий системный вызов (например, read(), write(), select()) **передаётся ядру ОС**, и поток 
переходит в состояние ожидания. В этот момент **GIL автоматически отпускается, и другой поток может его захватить**. 
Когда системный вызов завершается, поток снова пытается захватить GIL.
- - В потоках, **переключение происходит принудительно (вытесняющая многозадачность)**, даже если код не содержит 
явного указания на переключение (**в отличие от await**).


- **Сопрограмма** - функция/метод, который имеет возможность приостанавливаться и продолжать свое выполнение позже:
- - **Классическая сопрограмма** - использует **генераторные функции** (устарело с python 3.5-3.6, но обратно 
совместимо).
- - **Платформенная сопрограмма** - использует конструкцию **async/await**.
- - Управляются **циклом событий(Event-Loop)** в рамках одного **потока**.
- - **Кооперативная многозадачность** - поддерживание конкурентного выполнения, переключение осуществляет 
**Event-Loop**. Каждое блокирование события блокирует цикл событий (это отличает **Сопрограммы** от 
**Потоков/Процессов**, т.к. последние основаны на **Вытесняющей многозадачности**).


- **Блокировка (Lock)** — механизм синхронизации, который гарантирует, что только один поток или процесс в данный 
момент может получить доступ к разделяемому ресурсу, сохраняя целостность данных.


- **Состязание** - спор нескольких единиц выполнения за общий ресурс(блокировка, ресурс или процессорное время), 
который может в некоторых случаях привести к **состоянию гонки**.


- **Состояние гонки (Race Condition)** — ошибка, возникающая при одновременном доступе нескольких потоков 
или процессов к общим данным без должной синхронизации, что приводит к непредсказуемым результатам.


- **Вытесняющая многозадачность** - планировщик ОС или интерпретатор принудительно переключает задачи по таймеру или 
при системных вызовах (процессы, потоки в Python с GIL).


- **Кооперативная многозадачность** - задачи сами решают, когда уступить управление (сопрограммы с await).


- **GIL (Global Interpreter Lock)** - глобальная блокировка интерпретатора CPython, которая гарантирует, что в каждый 
момент времени только один поток выполняет байт-код Python, предотвращая одновременное выполнение Python-кода 
несколькими потоками внутри одного процесса.


- **Event-Loop** - цикл событий, управляющий асинхронным выполнением корутин внутри одного потока, который 
кооперативно переключается между задачами, ожидающими завершения операций ввода-вывода или иных событий.

- **Deadlock (взаимная блокировка)** - ситуация, когда несколько потоков или процессов навсегда ждут 
друг друга, блокируя выполнение программы.
